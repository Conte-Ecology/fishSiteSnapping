Fish Site Snapping
==================
Examination of the observed occupancy points has shown that some of the 
locations do not spatially align with the 
[NHDHRDV2](http://conte-ecology.github.io/shedsGisData/) stream network. Sample 
locations were found to fall into four classifications, involving three 
versions of flowlines. The processing steps outlined in this repository snap 
the locations to the stream network in ArcGIS.
<br><br>


## Flowline Versions
Three flowlines versions are used in the snapping process:
1. "detailed" - All inclusive high resolution flowlines
2. "truncated" - The high resolution flowlines trimmed to a 0.75 km<sup>2</sup> 
drainage area threshold
3. "dem" - The flowlines generated by setting the 0.75 km<sup>2</sup> threshold 
on the flow accumulation layer.

The "dem" flowlines are the threshold that is used to trim the "detailed" 
flowlines and create the "truncated" flowlines. This layer includes all cells 
that have 0.75 km<sup>2</sup> drainage area or greater, not just those that 
fall within the high resolution network. For practical purposes these can be 
considered undocumented streams, meaning they are not included in the original 
NHD high resolution data but could still exist. These streams were considered 
because of case #2 below.
<br><br>


## Location Classification Types
Fish sample sites fall into one of four classifications outline below: 
<br>

1.Detailed Network Only - The point is on the "detailed" network (red), but 
not on the "truncated" network (green). 
![Figure 1](https://cloud.githubusercontent.com/assets/6216239/19661883/6a079f96-9a03-11e6-9cc7-48de14e87eeb.png) 
<br>
Figure 1: A site only on the detailed network
<br><br>

2.Undocumented Stream - The point is on a "dem" network (blue), but not 
located on the "detailed" network (red).
![Figure 2](https://cloud.githubusercontent.com/assets/6216239/19661890/70277e5a-9a03-11e6-8b4e-05a0e7f566e8.png)
<br>
Figure 2: A site on an undocumented stream
<br><br>

3.Outside Buffer - Points are not near any of the network versions. These are 
accounted for by setting a snap distance.
![Figure 3](https://cloud.githubusercontent.com/assets/6216239/19661894/75e896e4-9a03-11e6-8351-1fc3235208fe.png)
<br>
Figure 3: A site outside of the maximum snapping distance
<br><br>

4.Truncated Network - The points are on all of the network versions. These 
points are the ones kept for use with stream network analysis. 
![Figure 4](https://cloud.githubusercontent.com/assets/6216239/19661899/7aeff8c6-9a03-11e6-952b-2dbfae1b4844.png)
<br>
Figure 4: A site usable with the stream network analysis
<br><br>


## Classification Summary
The current breakdown of where the sample locations fall in relation to the 
flowlines is listed in the table below. The maximum snapping distance was set 
to 100m. Any points outside of this distance were left unsnapped. The sites in 
the "Truncated Network" classification are the ones used in the 
[Network Analysis (Trout GRF)](https://github.com/djhocking/Trout_GRF/tree/master/Code/createNetwork) 
project. The points used are the observed occupancy sites from December 2013. 
The whole process is scripted so it should be simple enough to update with new 
sites as needed.

| Location Classification  | Number of Sites |
| :---------------------:  | :-------------: |
| Detailed Network Only    | 1291            |
| Outside 100 Meter Buffer | 1935            |
| Truncated Network        | 33011	         |
| Undocumented Stream	     | 529	           |
| **Total Sites**	         | **36766**	     |
Table 1: Sites classification
<br><br>


## Process Execution
The snapping processing is carried out in the `mapOccupancySitesToNetwork.py` 
script. Define the variables in the "Specify inputs" and execute the script in 
Arc Python. 

 - `networkGrid_DEM` - the filepath to the DEM flow grid
 - `networkGrid_Detailed` - the filepath to the high resolution flow grid  
 - `networkGrid_Truncated` - the filepath to the truncated flow grid
 - `points` - the filepath to the locations shapefile
 - `version` - the version ID of the fish points (e.g. "VTFS")
 - `bufferInMeters` - length in meters of the maximum snapping distance
 - `workingDirectory` - the filepath to the file geodatabase where snapped 
 points will be saved
<br><br>


## Contact Info
Kyle O'Neil  
koneil@usgs.gov